k8s:
  manually-deployed:
    configs:
      - apiserver-network-policy.yaml

    # Manually deployed so it can be used to override
    configmaps:
      - name: apiserver-nginx-override-conf
        from-file:
          filename: nginx-override.conf

    # If you change the nginx override, it needs a rolling restart
    custom-post-apply:
      - kubectl rollout restart deployment apiserver-deployment

  release:
    config-template: apiserver-deployment.template.yaml
    configmaps:
      - name: apiserver-nginx-base-conf
        from-file:
          filename: ../../containers/ocaml-nginx/base-nginx.conf
      - name: apiserver-nginx-conf
        from-file:
          filename: nginx.conf
    containers:
      - gcp-fsharp-apiserver
      - legacyserver
    builtins:
      - CLOUDSQL_INSTANCE_NAME
    expected-args:
      - CHANGE_CAUSE
